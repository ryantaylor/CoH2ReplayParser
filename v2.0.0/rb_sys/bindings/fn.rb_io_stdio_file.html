<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Finds or creates  a stdio’s file structure  from a Ruby’s one.   This can be handy if you want to call an external API that accepts `FILE *`."><meta name="keywords" content="rust, rustlang, rust-lang, rb_io_stdio_file"><title>rb_io_stdio_file in rb_sys::bindings - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../rb_sys/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../rb_sys/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In rb_sys::bindings</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Function <a href="../index.html">rb_sys</a>::<wbr><a href="index.html">bindings</a>::<wbr><a class="fn" href="#">rb_io_stdio_file</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/rb_sys/Users/ryantaylor/Code/vault/target/debug/build/rb-sys-8f1975fcdcff6741/out/bindings-0.9.70-arm64-darwin21-3.2.0.rs.html#20479">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust fn"><code>pub unsafe extern &quot;C&quot; fn rb_io_stdio_file(<br>&nbsp;&nbsp;&nbsp;&nbsp;fptr: <a class="primitive" href="https://doc.rust-lang.org/1.67.1/std/primitive.pointer.html">*mut </a><a class="struct" href="struct.rb_io_t.html" title="struct rb_sys::bindings::rb_io_t">rb_io_t</a><br>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.67.1/std/primitive.pointer.html">*mut </a><a class="type" href="type.FILE.html" title="type rb_sys::bindings::FILE">FILE</a></code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Finds or creates  a stdio’s file structure  from a Ruby’s one.   This can be
handy if you want to call an external API that accepts <code>FILE *</code>.</p>
<hr />
<h4 id="note"><a href="#note">Note</a></h4>
<p>Note however, that <code>FILE</code>s can  have their own buffer.  Mixing Ruby’s
and stdio’s file are basically dangerous.  Use with care.</p>
<ul>
<li><strong>@param</strong> <code>in,out</code> fptr  Target IO.</li>
<li><strong>@return</strong> A stdio’s file, created if absent.</li>
<li><strong>@post</strong> <code>fptr</code> has its corresponding stdio’s file.</li>
</ul>
<hr />
<h4 id="internal"><a href="#internal">Internal</a></h4>
<p>We had rich support  for <code>FILE</code> before!  In the days  of 1.8.x ::<a href="struct.rb_io_t.html" title="rb_io_t"><code>rb_io_t</code></a> was
like this:</p>
<div class="example-wrap"><pre class="language-CXX"><code>typedef struct [`rb_io_t`] {
FILE *f;                    // stdio ptr for read/write
FILE *f2;                   // additional ptr for rw pipes
int mode;                   // mode flags
int pid;                    // child&#39;s pid (for pipes)
int lineno;                 // number of lines read
char *path;                 // pathname for file
void (*finalize) _((struct [`rb_io_t`]*,int)); // finalize proc
} [`rb_io_t`];
</code></pre></div>
<p>But we  eventually abandoned this layout.   It was too difficult.   We could
not have fine-grained control over the <code>f</code> field.</p>
<ul>
<li>
<p><code>FILE</code> tends  to be  an opaque  struct.  It does  not interface  well with
<code>select(2)</code> etc.   This makes  IO multiplexing  quite hard.   Using stdio,
there is arguably no portable way to know if <code>fwrite(3)</code> blocks.</p>
</li>
<li>
<p>Nonblocking  mode,  which   is  another  core  concept   that  enables  IO
multiplexing, does not interface with stdio routines at all.</p>
</li>
<li>
<p>Detection of duplexed IO is also hard for the same reason.</p>
</li>
<li>
<p><code>feof(3)</code> is not portable.
<a href="https://mail.python.org/pipermail/python-dev/2001-January/011390.html">https://mail.python.org/pipermail/python-dev/2001-January/011390.html</a></p>
</li>
<li>
<p>Solaris was a thing  back then.  They could not have  more than 256 <code>FILE</code>
structures  at  a  time.   Their   file  descriptors  ware  stored  in  an
<code>unsigned char</code>.</p>
</li>
<li>
<p>It is next to impossible to avoid  SEGV, especially when a thread tries to
<code>ungetc(3)</code>-ing from a <code>FILE</code> which is <code>fread(3)</code>-ed by another one.</p>
</li>
</ul>
<h3 id="in-short-it-is-a-bad-idea-to-let-someone-else-manage-io-buffers-especiallysomeone--you-cannot--control---this-still--applies--to-extension--librariesmethinks--ruby-doesnt-prevent-you-from--shooting-yourself-in-the-foot-butconsider-yourself-warned-here"><a href="#in-short-it-is-a-bad-idea-to-let-someone-else-manage-io-buffers-especiallysomeone--you-cannot--control---this-still--applies--to-extension--librariesmethinks--ruby-doesnt-prevent-you-from--shooting-yourself-in-the-foot-butconsider-yourself-warned-here">In short, it is a bad idea to let someone else manage IO buffers, especially
someone  you cannot  control.   This still  applies  to extension  libraries
methinks.  Ruby doesn’t prevent you from  shooting yourself in the foot, but
consider yourself warned here.</a></h3>
<p>Generated by <a href="https://github.com/oxidize-rb/rb-sys">rb-sys</a> for Ruby 3.2.0</p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rb_sys" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.1 (d5a82bbd2 2023-02-07)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>