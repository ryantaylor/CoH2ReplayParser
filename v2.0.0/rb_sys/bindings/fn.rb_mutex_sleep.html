<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Releases  the lock  held in  the mutex  and waits  for the  period of  time; reacquires the lock on wakeup."><meta name="keywords" content="rust, rustlang, rust-lang, rb_mutex_sleep"><title>rb_mutex_sleep in rb_sys::bindings - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../rb_sys/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../rb_sys/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In rb_sys::bindings</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Function <a href="../index.html">rb_sys</a>::<wbr><a href="index.html">bindings</a>::<wbr><a class="fn" href="#">rb_mutex_sleep</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/rb_sys/Users/ryantaylor/Code/vault/target/debug/build/rb-sys-8f1975fcdcff6741/out/bindings-0.9.70-arm64-darwin21-3.2.0.rs.html#15745">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust fn"><code>pub unsafe extern &quot;C&quot; fn rb_mutex_sleep(<br>&nbsp;&nbsp;&nbsp;&nbsp;self_: <a class="type" href="type.VALUE.html" title="type rb_sys::bindings::VALUE">VALUE</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;timeout: <a class="type" href="type.VALUE.html" title="type rb_sys::bindings::VALUE">VALUE</a><br>) -&gt; <a class="type" href="type.VALUE.html" title="type rb_sys::bindings::VALUE">VALUE</a></code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Releases  the lock  held in  the mutex  and waits  for the  period of  time;
reacquires the lock on wakeup.</p>
<ul>
<li><strong>@pre</strong> The lock has to be owned by the current thread beforehand.</li>
<li><strong>@param</strong> <code>out</code> self             The target mutex.</li>
<li><strong>@param</strong> <code>in</code> timeout          Duration, in seconds, in ::<a href="static.rb_cNumeric.html" title="rb_cNumeric"><code>rb_cNumeric</code></a>.</li>
<li><strong>@exception</strong> <a href="static.rb_eArgError.html" title="rb_eArgError"><code>rb_eArgError</code></a>     <code>timeout</code> is negative.</li>
<li><strong>@exception</strong> <a href="static.rb_eRangeError.html" title="rb_eRangeError"><code>rb_eRangeError</code></a>   <code>timeout</code> is out of range of <code>time_t</code>.</li>
<li><strong>@exception</strong> <a href="static.rb_eThreadError.html" title="rb_eThreadError"><code>rb_eThreadError</code></a>  The mutex is not owned by the current thread.</li>
<li><strong>@return</strong> Number of seconds it actually slept.</li>
</ul>
<hr />
<h4 id="warning"><a href="#warning">Warning</a></h4>
<p>It is a  failure not to check the return  value.  This function
can return spuriously for various reasons.  Maybe other threads
can  <a href="fn.rb_thread_wakeup.html" title="rb_thread_wakeup"><code>rb_thread_wakeup</code></a>.   Maybe  an  end user  can  press  the
Control and C  key from the interactive console.   On the other
hand it  can also  take longer than  the specified.   The mutex
could be locked by someone else.  It waits then.</p>
<ul>
<li><strong>@post</strong> Upon successful return the passed mutex is owned by the current
thread.</li>
</ul>
<hr />
<h4 id="internal"><a href="#internal">Internal</a></h4>
<p>This  function is  called from  <code>ConditionVariable#wait</code>.   So it  is not  a
deprecated feature.   However @shyouhei  have never  seen any  similar mutex
primitive available in any other languages than Ruby.</p>
<p>EDIT: In 2021,  @shyouhei asked @ko1 in person about  this API.  He answered
that it is his invention.  The  motivation behind its design is to eliminate
needs of condition variables as  primitives.  Unlike other languages, Ruby’s
<code>ConditionVariable</code> class was written in pure-Ruby initially.  We don’t have
to implement  machine-native condition  variables in  assembly each  time we
port Ruby to a new architecture.  This function made it possible.  &quot;I felt I
was a genius when this idea came to me&quot;, said @ko1.</p>
<h3 id="rb_cconditionvariable-is-now-written-in-c-for-speed-though"><a href="#rb_cconditionvariable-is-now-written-in-c-for-speed-though"><code>[</code>rb_cConditionVariable<code>]</code> is now written in C for speed, though.</a></h3>
<p>Generated by <a href="https://github.com/oxidize-rb/rb-sys">rb-sys</a> for Ruby 3.2.0</p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rb_sys" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.1 (d5a82bbd2 2023-02-07)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>