<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Maybe this  is the only  function provided for  C extensions to  control the pinning of objects, so  let us describe it in detail.   These days Ruby’s GC is copying.  As far as an object’s physical address is guaranteed unused, it can move  around the object space.   Our GC engine rearranges  these objects after it  reclaims unreachable objects  from our  object space, so  that the space  is   compact  (improves  memory   locality).   This  is   called  the &quot;compaction&quot; phase, and works  well most of the time… as  far as there are no C  extensions.  C  extensions complicate the  scenario because  Ruby core cannot detect  any use  of the  physical address  of an  object inside  of C functions.  In order to prevent  memory corruptions, objects observable from C extensions are &quot;pinned&quot;; they stick to where they are born until they die, just in  case any C  extensions touch their  raw pointers.  This  variant of scheme  is   called  &quot;Mostly-Copying&quot;  garbage  collector.    Authors  of  C extensions,  however,   can  extremely   carefully  write  them   to  become compaction-aware.  To do so avoid referring  to a Ruby object from inside of your struct  in the  first place.   But if  that is  not possible,  use this function  from your  ::[`rb_data_type_struct`]::dmark  then.   This way  objects marked using it are  considered movable.  If you chose this  way you have to manually fix up locations of such moved pointers using [`rb_gc_location`]."><meta name="keywords" content="rust, rustlang, rust-lang, rb_gc_mark_movable"><title>rb_gc_mark_movable in rb_sys::bindings - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../rb_sys/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../rb_sys/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In rb_sys::bindings</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Function <a href="../index.html">rb_sys</a>::<wbr><a href="index.html">bindings</a>::<wbr><a class="fn" href="#">rb_gc_mark_movable</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/rb_sys/Users/ryantaylor/Code/vault/target/debug/build/rb-sys-8f1975fcdcff6741/out/bindings-0.9.70-arm64-darwin21-3.2.0.rs.html#10864">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust fn"><code>pub unsafe extern &quot;C&quot; fn rb_gc_mark_movable(obj: <a class="type" href="type.VALUE.html" title="type rb_sys::bindings::VALUE">VALUE</a>)</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Maybe this  is the only  function provided for  C extensions to  control the
pinning of objects, so  let us describe it in detail.   These days Ruby’s GC
is copying.  As far as an object’s physical address is guaranteed unused, it
can move  around the object space.   Our GC engine rearranges  these objects
after it  reclaims unreachable objects  from our  object space, so  that the
space  is   compact  (improves  memory   locality).   This  is   called  the
&quot;compaction&quot; phase, and works  well most of the time… as  far as there are
no C  extensions.  C  extensions complicate the  scenario because  Ruby core
cannot detect  any use  of the  physical address  of an  object inside  of C
functions.  In order to prevent  memory corruptions, objects observable from
C extensions are &quot;pinned&quot;; they stick to where they are born until they die,
just in  case any C  extensions touch their  raw pointers.  This  variant of
scheme  is   called  &quot;Mostly-Copying&quot;  garbage  collector.    Authors  of  C
extensions,  however,   can  extremely   carefully  write  them   to  become
compaction-aware.  To do so avoid referring  to a Ruby object from inside of
your struct  in the  first place.   But if  that is  not possible,  use this
function  from your  ::<a href="struct.rb_data_type_struct.html" title="rb_data_type_struct"><code>rb_data_type_struct</code></a>::dmark  then.   This way  objects
marked using it are  considered movable.  If you chose this  way you have to
manually fix up locations of such moved pointers using <a href="fn.rb_gc_location.html" title="rb_gc_location"><code>rb_gc_location</code></a>.</p>
<ul>
<li>
<p><strong>@see</strong> Bartlett,  Joel  F.,  &quot;Compacting Garbage  Collection  with  Ambiguous
Roots&quot;,  ACM  SIGPLAN  Lisp  Pointers  Volume  1  Issue  6  pp.  3-12,
April-May-June, 1988. <a href="https://doi.org/10.1145/1317224.1317225">https://doi.org/10.1145/1317224.1317225</a></p>
</li>
<li>
<p><strong>@param</strong> <code>in</code> obj  Object that is movable.</p>
</li>
<li>
<p><strong>@post</strong> Values stored in <code>tbl</code> are marked.</p>
</li>
</ul>
<hr />
<p>Generated by <a href="https://github.com/oxidize-rb/rb-sys">rb-sys</a> for Ruby 3.2.0</p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rb_sys" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.1 (d5a82bbd2 2023-02-07)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>